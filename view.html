<!DOCTYPE html>

<html lang="zh-TW">

<head>

Â  <meta charset="UTF-8" />

Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

Â  <title>UTå°è»Šé»æª¢ç´€éŒ„æŸ¥è©¢</title>

Â  <script src="https://unpkg.com/html5-qrcode"></script>

Â  <style>

Â  Â  body {

Â  Â  Â  font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;

Â  Â  Â  background-color: #f7f7f7;

Â  Â  Â  padding: 20px;

Â  Â  Â  margin: 0;

Â  Â  }

Â  Â  h2 {

Â  Â  Â  text-align: center;

Â  Â  Â  color: #333;

Â  Â  }

Â  Â  #reader {

Â  Â  Â  width: 100%;

Â  Â  Â  max-width: 320px;

Â  Â  Â  margin: 0 auto 20px;

Â  Â  }

Â  Â  .status {

Â  Â  Â  text-align: center;

Â  Â  Â  font-weight: bold;

Â  Â  Â  margin-bottom: 10px;

Â  Â  }

Â  Â  .info {

Â  Â  Â  text-align: center;

Â  Â  Â  font-size: 15px;

Â  Â  Â  margin: 8px 0;

Â  Â  Â  color: #444;

Â  Â  }

Â  Â  .error {

Â  Â  Â  color: red;

Â  Â  Â  text-align: center;

Â  Â  Â  font-weight: bold;

Â  Â  }

Â  Â  .card {

Â  Â  Â  background-color: white;

Â  Â  Â  border-radius: 12px;

Â  Â  Â  box-shadow: 0 2px 8px rgba(0,0,0,0.08);

Â  Â  Â  padding: 16px;

Â  Â  Â  margin-bottom: 16px;

Â  Â  }

Â  Â  .card-title {

Â  Â  Â  font-weight: bold;

Â  Â  Â  color: #555;

Â  Â  Â  margin-bottom: 6px;

Â  Â  }

Â  Â  .card-content {

Â  Â  Â  font-size: 15px;

Â  Â  Â  color: #222;

Â  Â  Â  word-wrap: break-word;

Â  Â  }

Â  Â  button {

Â  Â  Â  width: 100%;

Â  Â  Â  padding: 12px;

Â  Â  Â  background-color: #007bff;

Â  Â  Â  color: white;

Â  Â  Â  border: none;

Â  Â  Â  font-size: 16px;

Â  Â  Â  border-radius: 8px;

Â  Â  Â  cursor: pointer;

Â  Â  Â  margin-top: 12px;

Â  Â  }

Â  Â  button:hover {

Â  Â  Â  background-color: #0056b3;

Â  Â  }

Â  Â  #loadingOverlay {

Â  Â  Â  display: none;

Â  Â  Â  position: fixed;

Â  Â  Â  top: 0; left: 0;

Â  Â  Â  width: 100%; height: 100%;

Â  Â  Â  background: rgba(0, 0, 0, 0.4);

Â  Â  Â  color: white;

Â  Â  Â  font-size: 20px;

Â  Â  Â  justify-content: center;

Â  Â  Â  align-items: center;

Â  Â  Â  z-index: 999;

Â  Â  }

Â  </style>

</head>

<body>



<h2>ğŸ“‹ UTå°è»Šé»æª¢ç´€éŒ„æŸ¥è©¢</h2>

<div id="reader"></div>

<p id="carIdDisplay" class="status">ğŸ“· ç­‰å¾…æƒæ QR Code...</p>

<div id="resultArea"></div>

<button id="rescanBtn" style="display:none;">ğŸ”„ é‡æ–°æƒæ</button>

<div id="loadingOverlay">âŒ› æŸ¥è©¢ä¸­ï¼Œè«‹ç¨å€™...</div>



<script>

Â  const GAS_URL = "https://script.google.com/macros/s/AKfycbx4SpWKpKqPhADrIn1KSVZRIK2Fv7mcw-lMKOprCmASQhtJONilxXuM5wI1MSsnKRhlFA/exec";



Â  let qrScanner;

Â  let intervalId;



Â  function startScanner() {

Â  Â  qrScanner = new Html5Qrcode("reader");

Â  Â  qrScanner.start(

Â  Â  Â  { facingMode: "environment" },

Â  Â  Â  {

Â  Â  Â  Â  fps: 5,

Â  Â  Â  Â  qrbox: 250,

Â  Â  Â  Â  videoConstraints: { width: { ideal: 640 }, height: { ideal: 480 } }

Â  Â  Â  },

Â  Â  Â  qrCodeMessage => {

Â  Â  Â  Â  const carId = qrCodeMessage.trim();

Â  Â  Â  Â  document.getElementById("carIdDisplay").innerText = `ğŸšš å°è»Šç·¨è™Ÿï¼š${carId}`;

Â  Â  Â  Â  qrScanner.stop();

Â  Â  Â  Â  clearInterval(intervalId);

Â  Â  Â  Â  fetchData(carId);

Â  Â  Â  },

Â  Â  Â  errorMessage => { }

Â  Â  ).catch(err => {

Â  Â  Â  document.getElementById("carIdDisplay").innerText = "âŒ ç„¡æ³•å•Ÿç”¨æ”å½±æ©Ÿï¼š" + err;

Â  Â  });



Â  Â  intervalId = setInterval(() => {

Â  Â  Â  qrScanner.pause();

Â  Â  Â  setTimeout(() => qrScanner.resume(), 300);

Â  Â  }, 5000);

Â  }



Â  function fetchData(carId) {

Â  Â  const overlay = document.getElementById("loadingOverlay");

Â  Â  overlay.style.display = "flex";



Â  Â  const url = `${GAS_URL}?mode=view&carId=${encodeURIComponent(carId)}`;

Â  Â  fetch(url)

Â  Â  Â  .then(res => res.headers.get("content-type")?.includes("application/json") ? res.json() : res.text().then(t => { throw new Error(t); }))

Â  Â  Â  .then(data => {

Â  Â  Â  Â  const resultArea = document.getElementById("resultArea");

Â  Â  Â  Â  resultArea.innerHTML = `

Â  Â  Â  Â  Â  <div class="info">ğŸ“… é»æª¢æ—¥æœŸï¼š${data.date}</div>

Â  Â  Â  Â  Â  <div class="info">ğŸ‘·â€â™‚ï¸ é»æª¢äººå“¡å·¥è™Ÿï¼š${data.values[0] || "-"}</div>

Â  Â  Â  Â  `;



Â  Â  Â  Â  for (let i = 1; i < data.headers.length; i++) {

Â  Â  Â  Â  Â  resultArea.innerHTML += `

Â  Â  Â  Â  Â  Â  <div class="card">

Â  Â  Â  Â  Â  Â  Â  <div class="card-title">${data.headers[i]}</div>

Â  Â  Â  Â  Â  Â  Â  <div class="card-content">${data.values[i] || "-"}</div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  }



Â  Â  Â  Â  document.getElementById("rescanBtn").style.display = "inline-block";

Â  Â  Â  })

Â  Â  Â  .catch(err => {

Â  Â  Â  Â  document.getElementById("resultArea").innerHTML = `<p class="error">âŒ æŸ¥è©¢å¤±æ•—ï¼š${err.message}</p>`;

Â  Â  Â  })

Â  Â  Â  .finally(() => {

Â  Â  Â  Â  overlay.style.display = "none";

Â  Â  Â  });

Â  }



Â  document.getElementById("rescanBtn").addEventListener("click", () => {

Â  Â  document.getElementById("resultArea").innerHTML = "";

Â  Â  document.getElementById("carIdDisplay").innerText = "ğŸ“· ç­‰å¾…é‡æ–°æƒæ QR Code...";

Â  Â  document.getElementById("rescanBtn").style.display = "none";

Â  Â  qrScanner.clear();

Â  Â  startScanner();

Â  });



Â  // åˆå§‹åŒ–

Â  startScanner();

</script>



</body>

</html>
