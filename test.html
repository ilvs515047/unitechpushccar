<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <title>UT å°è»Šé»æª¢è¡¨å–®</title>
Â  <script src="https://unpkg.com/html5-qrcode"></script>
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
Â  Â  Â  background-color: #f5f5f5;
Â  Â  Â  padding: 20px;
Â  Â  Â  margin: 0;
Â  Â  }
Â  Â  h2 {
Â  Â  Â  text-align: center;
Â  Â  Â  color: #333;
Â  Â  }
Â  Â  #reader {
Â  Â  Â  width: 100%;
Â  Â  Â  max-width: 320px;
Â  Â  Â  margin: 0 auto 20px;
Â  Â  }
Â  Â  .status {
Â  Â  Â  text-align: center;
Â  Â  Â  font-weight: bold;
Â  Â  Â  margin-bottom: 10px;
Â  Â  }
Â  Â  .card {
Â  Â  Â  background-color: white;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
Â  Â  Â  padding: 16px;
Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â  .card-title {
Â  Â  Â  font-weight: bold;
Â  Â  Â  margin-bottom: 8px;
Â  Â  Â  color: #444;
Â  Â  }
Â  Â  label {
Â  Â  Â  display: block;
Â  Â  Â  margin-top: 8px;
Â  Â  Â  font-size: 14px;
Â  Â  }
Â  Â  input[type="text"] {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 6px;
Â  Â  Â  font-size: 14px;
Â  Â  Â  margin-top: 4px;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  }
Â  Â  input[type="checkbox"] {
Â  Â  Â  margin-right: 6px;
Â  Â  }
Â  Â  button {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 12px;
Â  Â  Â  background-color: #28a745;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  font-size: 16px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  button:hover {
Â  Â  Â  background-color: #218838;
Â  Â  }
Â  Â  #rescanBtn {
Â  Â  Â  margin-top: 10px;
Â  Â  Â  background-color: #007bff;
Â  Â  }
Â  Â  #rescanBtn:hover {
Â  Â  Â  background-color: #0056b3;
Â  Â  }
Â  Â  #result {
Â  Â  Â  text-align: center;
Â  Â  Â  margin-top: 20px;
Â  Â  Â  font-weight: bold;
Â  Â  Â  color: #444;
Â  Â  }
Â  Â  #loadingOverlay {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  background: rgba(0, 0, 0, 0.5);
Â  Â  Â  color: white;
Â  Â  Â  font-size: 22px;
Â  Â  Â  display: none; /* ç¢ºä¿åˆå§‹ç‹€æ…‹æ˜¯éš±è—çš„ */
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  Â  z-index: 9999;
Â  Â  }
Â  </style>
</head>
<body>

<h2>UT å°è»Šé»æª¢ç³»çµ±</h2>
<div id="reader"></div>
<p id="carIdDisplay" class="status">ğŸ“· ç­‰å¾…æƒæ QR Code...</p>
<button id="rescanBtn" style="display:none;">ğŸ”„ é‡æ–°æƒæ</button>

<form id="checkForm" style="display:none;">
Â  <div class="card">
Â  Â  <div class="card-title">ğŸ‘·â€â™‚ï¸ é»æª¢äººå“¡å·¥è™Ÿ</div>
Â  Â  <label><input type="text" name="workerId" required></label>
Â  </div>

Â  <div class="card">
Â  Â  <div class="card-title">ğŸ”§ å‰è¼ªï¼ˆè½‰å‘è¼ªï¼‰</div>
Â  Â  <label>1. ç„Šæ¥å¤šå°‘% <input type="text" name="f1"></label>
Â  Â  <label><input type="checkbox" name="f1_ok"> ç„¡ç•°å¸¸</label>
Â  Â  <label>2. å¹³å°&è»Šè¼ªæ˜¯å¦ç•°å¸¸ <input type="text" name="f2"></label>
Â  Â  <label><input type="checkbox" name="f2_ok"> ç„¡ç•°å¸¸</label>
Â  Â  <label>3. è»Šè¼ª/ç…è»Šæè¿° <input type="text" name="f3"></label>
Â  Â  <label><input type="checkbox" name="f3_ok"> ç„¡ç•°å¸¸</label>
Â  </div>

Â  <div class="card">
Â  Â  <div class="card-title">ğŸ”§ å¾Œè¼ªï¼ˆæ‰‹æŠŠç«¯ï¼‰</div>
Â  Â  <label>1. ç„Šæ¥å¤šå°‘% <input type="text" name="b1"></label>
Â  Â  <label><input type="checkbox" name="b1_ok"> ç„¡ç•°å¸¸</label>
Â  Â  <label>2. å¹³å°&è»Šè¼ªæ˜¯å¦ç•°å¸¸ <input type="text" name="b2"></label>
Â  Â  <label><input type="checkbox" name="b2_ok"> ç„¡ç•°å¸¸</label>
Â  Â  <label>3. è»Šè¼ª/ç…è»Šæè¿° <input type="text" name="b3"></label>
Â  Â  <label><input type="checkbox" name="b3_ok"> ç„¡ç•°å¸¸</label>
Â  </div>

Â  <div class="card">
Â  Â  <div class="card-title">ğŸ”§ è»Šæ¶/éª¨æ¶æ¥ç¸«è™•</div>
Â  Â  <label>æè¿°ç‹€æ³ <input type="text" name="frame"></label>
Â  Â  <label><input type="checkbox" name="frame_ok"> ç„¡ç•°å¸¸</label>
Â  </div>

Â  <button type="submit">âœ… æäº¤é»æª¢</button>
</form>

<p id="result"></p>

<div id="loadingOverlay">âŒ› æäº¤ä¸­...è«‹ç¨å€™</div>

<script>
Â  const GAS_URL = "https://script.google.com/macros/s/AKfycbzq1aWVOAwWHp50RQEIz7vrm6nDBzX-Yrf-QX9PYddSL8JtTAun-NfwcoB2cocmqb0osQ/exec";
Â  let scannedCarId = "";
Â  let qrScanner;
Â  let intervalId; // é€™å€‹è®Šæ•¸ç›®å‰æ²’æœ‰è¢«æ¸…é™¤ï¼Œä½†å› ç‚º scan æˆåŠŸå¾Œæœƒ stop æ”å½±æ©Ÿï¼Œæ‰€ä»¥å½±éŸ¿ä¸å¤§

Â  const startScan = () => {
Â  Â  // æ¯æ¬¡é‡æ–°æƒææ™‚éƒ½å‰µå»ºæ–°çš„ Html5Qrcode å¯¦ä¾‹ï¼Œç¢ºä¿æ¸…ç†èˆŠçš„ç‹€æ…‹
Â  Â  qrScanner = new Html5Qrcode("reader");
Â  Â  qrScanner.start(
Â  Â  Â  { facingMode: "environment" },
Â  Â  Â  {
Â  Â  Â  Â  fps: 5, // é™ä½å¹€ç‡æœ‰åŠ©æ–¼æ¸›å°‘æ•ˆèƒ½è² æ“”
Â  Â  Â  Â  qrbox: 250,
Â  Â  Â  Â  aspectRatio: 1.777,
Â  Â  Â  Â  videoConstraints: {
Â  Â  Â  Â  Â  width: { ideal: 640 },
Â  Â  Â  Â  Â  height: { ideal: 480 }
Â  Â  Â  Â  }
Â  Â  Â  },
Â  Â  Â  qrCodeMessage => {
Â  Â  Â  Â  scannedCarId = qrCodeMessage.trim();
Â  Â  Â  Â  document.getElementById("carIdDisplay").innerText = `ğŸ“· æ­¤ç‚ºç·¨è™Ÿï¼šã€Œ${scannedCarId}ã€çš„å°è»Š`;
Â  Â  Â  Â  qrScanner.stop();
Â  Â  Â  Â  // æƒææˆåŠŸå¾Œï¼Œæ¸…é™¤ä»»ä½•å¯èƒ½å­˜åœ¨çš„ pause/resume interval
Â  Â  Â  Â  if (intervalId) {
Â  Â  Â  Â  Â  clearInterval(intervalId);
Â  Â  Â  Â  Â  intervalId = null;
Â  Â  Â  Â  }
Â  Â  Â  Â  document.getElementById("checkForm").style.display = "block";
Â  Â  Â  Â  document.getElementById("rescanBtn").style.display = "inline-block";
Â  Â  Â  },
Â  Â  Â  errorMessage => {
Â  Â  Â  Â  // é€™è£¡å¯ä»¥é¸æ“‡æ€§åœ°è™•ç†éŒ¯èª¤ï¼Œä¾‹å¦‚ console.warn(errorMessage);
Â  Â  Â  }
Â  Â  ).catch(err => {
Â  Â  Â  document.getElementById("carIdDisplay").innerText = "âŒ ç„¡æ³•å•Ÿç”¨æ”å½±æ©Ÿï¼š" + err.message + " è«‹æª¢æŸ¥æ¬Šé™ã€‚";
Â  Â  Â  console.error("Html5Qrcode Start Error: ", err);
Â  Â  });

Â  Â  // é€™æ˜¯ç‚ºäº†æ”¹å–„å¡é “çš„å˜—è©¦ï¼Œä½†å¯èƒ½å°è‡´ç•«é¢é–ƒçˆã€‚
Â  Â  // å¦‚æœé™ä½ fps å·²ç¶“è¶³å¤ ï¼Œå¯ä»¥è€ƒæ…®ç§»é™¤é€™å€‹ intervalã€‚
Â  Â  // ç¢ºä¿åœ¨æƒææˆåŠŸæˆ–é‡æ–°æƒææ™‚æ¸…é™¤é€™å€‹ intervalã€‚
Â  Â  if (intervalId) { // å…ˆæ¸…é™¤èˆŠçš„ intervalï¼Œé¿å…é‡è¤‡å•Ÿå‹•
Â  Â  Â  clearInterval(intervalId);
Â  Â  }
Â  Â  intervalId = setInterval(() => {
Â  Â  Â  if (qrScanner.is.</script>
</body>
</html>
