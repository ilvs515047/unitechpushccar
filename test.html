<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>台車點檢表單</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .section { margin-bottom: 20px; }
    label { display: block; margin-top: 10px; }
    input[type="text"] { width: 100%; padding: 4px; margin-top: 4px; }
  </style>
</head>
<body>
  <h2>台車點檢系統（點檢端）</h2>
  <div id="reader" style="width:300px;"></div>
  <p id="carIdDisplay" style="font-weight:bold;"></p>

  <form id="checkForm" style="display:none;">
    <div class="section"><strong>🔧 前輪（轉向輪）</strong>
      <label>1. 車架&鐵片平台焊接多少% <input type="text" name="f1"></label>
      <label><input type="checkbox" name="f1_ok"> 無異常</label>

      <label>2. 鐵片平台&車輪是否異常 <input type="text" name="f2"></label>
      <label><input type="checkbox" name="f2_ok"> 無異常</label>

      <label>3. 車輪/煞車描述 <input type="text" name="f3"></label>
      <label><input type="checkbox" name="f3_ok"> 無異常</label>
    </div>

    <div class="section"><strong>🔧 後輪（手把端）</strong>
      <label>1. 車架&鐵片平台焊接多少% <input type="text" name="b1"></label>
      <label><input type="checkbox" name="b1_ok"> 無異常</label>

      <label>2. 鐵片平台&車輪是否異常 <input type="text" name="b2"></label>
      <label><input type="checkbox" name="b2_ok"> 無異常</label>

      <label>3. 車輪/煞車描述 <input type="text" name="b3"></label>
      <label><input type="checkbox" name="b3_ok"> 無異常</label>
    </div>

    <div class="section"><strong>🔧 車架/骨架接縫處</strong>
      <label>描述狀況 <input type="text" name="frame"></label>
      <label><input type="checkbox" name="frame_ok"> 無異常</label>
    </div>

    <button type="submit">✅ 提交點檢</button>
  </form>

  <p id="result" style="font-weight:bold; margin-top:20px;"></p>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/YOUR_GAS_URL_HERE/exec";
    let scannedCarId = "";

    const qrScanner = new Html5Qrcode("reader");
    qrScanner.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      qrCodeMessage => {
        scannedCarId = qrCodeMessage;
        document.getElementById("carIdDisplay").innerText = `📷 此為編號：「${scannedCarId}」的台車`;
        qrScanner.stop();
        document.getElementById("checkForm").style.display = "block";
      },
      errorMessage => {}
    ).catch(err => {
      document.getElementById("carIdDisplay").innerText = "❌ 無法啟用攝影機：" + err;
    });

    document.getElementById("checkForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const formData = new FormData(this);
      const data = {
        mode: "checkin_detail",
        carId: scannedCarId
      };

      for (const [key, val] of formData.entries()) {
        data[key] = val || "";
      }

      fetch(GAS_URL + "?" + new URLSearchParams(data))
        .then(res => res.text())
        .then(txt => {
          document.getElementById("result").innerText = txt;
          this.reset();
        })
        .catch(err => {
          document.getElementById("result").innerText = "❌ 點檢失敗：" + err.message;
        });
    });
  </script>
</body>
</html>
