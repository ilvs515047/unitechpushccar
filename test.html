<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>台車點檢系統</title>
</head>
<body>
  <h2>台車點檢系統</h2>
  <label>選擇模式：</label>
  <select id="mode">
    <option value="checkin">✅ 我要點檢</option>
    <option value="lookup">🔍 查詢是否已點檢</option>
  </select>
  <br><br>

  <label>點檢人員姓名：</label>
  <input type="text" id="username" placeholder="請輸入姓名（查詢可空白）">
  <br><br>

  <label>車號 / QR 資料：</label>
  <input type="text" id="carId" placeholder="例如：CAR001">
  <br><br>

  <button onclick="submitForm()">送出</button>
  <p id="result" style="font-weight: bold;"></p>

  <script>
    function submitForm() {
      const mode = document.getElementById("mode").value;
      const user = document.getElementById("username").value;
      const carId = document.getElementById("carId").value;
      const resultEl = document.getElementById("result");

      // 將前端的驗證邏輯與後端保持一致，或只保留前端基本的非空驗證
      if (!carId) {
        alert("❌ 請輸入車號！");
        return;
      }
      if (mode === "checkin" && !user.trim()) {
        alert("❌ 點檢時請輸入姓名！");
        return;
      }

      resultEl.innerText = "📤 傳送中...";

      const formData = new URLSearchParams();
      formData.append("mode", mode);
      formData.append("carId", carId);
      formData.append("user", user);

      // 請確認這裡的 URL 是你最新部署的 GAS Web App URL
      fetch("https://script.google.com/macros/s/AKfycbwBDq0kPI3UM--wFI1dZbeYVec7j355Q5VFVIhEj_bnPG8WHm_zI_toKkIqG-wmr7Sw/exec", { // **重要：替換為你實際部署的 Web App URL**
        method: "POST",
        mode: "cors",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        body: formData
      })
      .then(r => {
        // 檢查響應是否成功，如果狀態碼不是 2xx，則拋出錯誤
        if (!r.ok) {
          throw new Error(`HTTP 錯誤！狀態碼：${r.status}`);
        }
        return r.json(); // 改為解析 JSON
      })
      .then(data => {
        // 根據 JSON 響應的 status 屬性顯示結果
        if (data.status === "success") {
          resultEl.innerText = `✅ 結果：${data.message}`;
        } else {
          resultEl.innerText = `🚨 錯誤：${data.message}`;
        }
      })
      .catch(err => {
        console.error("❌ 發送失敗：", err);
        resultEl.innerText = "🚨 發送失敗：" + err.message;
      });
    }
  </script>
</body>
</html>
